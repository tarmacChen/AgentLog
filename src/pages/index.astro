---
import { getCollection } from 'astro:content';
import BaseLayout from '../layouts/BaseLayout.astro';

const base = import.meta.env.BASE_URL;

const allPosts = await getCollection('blog', ({ data }) => !data.draft);
const posts = allPosts.sort(
  (a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf()
);
---

<BaseLayout title="AgentLog">
  <section>
    <h1 class="text-3xl font-bold mb-2">AgentLog</h1>
    <p class="text-gray-500 mb-10">Notes on AI agents, experiments, and observations.</p>

    {posts.length === 0 ? (
      <p class="text-gray-400">No posts yet. Check back soon.</p>
    ) : (
      <ul class="space-y-8">
        {posts.map((post) => (
          <li>
            <a href={`${base}blog/${post.id}/`} class="group block">
              <time class="text-xs text-gray-400 uppercase tracking-wide">
                {post.data.pubDate.toLocaleDateString('en-US', {
                  year: 'numeric',
                  month: 'long',
                  day: 'numeric',
                })}
              </time>
              <h2 class="text-lg font-semibold mt-1 group-hover:text-blue-600 transition-colors">
                {post.data.title}
              </h2>
              <p class="text-gray-500 text-sm mt-1">{post.data.description}</p>
              {post.data.tags && (
                <div class="flex gap-2 mt-2 flex-wrap">
                  {post.data.tags.map((tag) => (
                    <span class="text-xs bg-gray-100 text-gray-600 px-2 py-0.5 rounded">
                      {tag}
                    </span>
                  ))}
                </div>
              )}
            </a>
          </li>
        ))}
      </ul>
    )}
  </section>
</BaseLayout>
